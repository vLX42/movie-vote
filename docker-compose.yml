services:
  app:
    image: ghcr.io/vlx42/movie-vote:latest
    build: . # kept for local dev; ignored when pulling from registry
    ports:
      - "8090:3000"
    volumes:
      - ./db:/app/db-data
    environment:
      - NODE_ENV=production
      - DATABASE_URL=file:/app/db-data/movienightapp.db
      - JELLYFIN_URL=${JELLYFIN_URL:-http://jellyfin:8096}
      - JELLYFIN_API_KEY=${JELLYFIN_API_KEY}
      - JELLYSEERR_URL=${JELLYSEERR_URL:-http://jellyseerr:5055}
      - JELLYSEERR_API_KEY=${JELLYSEERR_API_KEY}
      - ADMIN_SECRET=${ADMIN_SECRET}
    networks:
      - movienightnet
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "node", "-e", "fetch('http://localhost:3000/').catch(()=>{}).then(()=>process.exit(0))"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

networks:
  movienightnet:
    external: true
